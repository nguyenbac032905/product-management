extends ../../layouts/default.pug
include ../../mixins/filterStatus.pug
include ../../mixins/search.pug
include ../../mixins/pagination.pug
include ../../mixins/formChangeMulti.pug
include ../../mixins/alert.pug
include ../../mixins/sort.pug
include ../../mixins/moment.pug
block main
    if(role.permission.includes("products_view"))
        +alertSuccess(3000)
        +alertError(3000)
        h1 Danh sách sản phẩm

        .card.mb-3
            .card-header Bộ lọc và Tìm kiếm
            .card-body
                .row
                    .col-6
                        +filterStatus(filterStatus)
                    .col-6 
                        +search(keyword)

        .card.mb-3
            .card-header Sắp xếp
            .card-body
                .row
                .col-4
                    +sort()
        .card.mb-3
            .card-header Danh sách sản phẩm
            .card-body
                .row 
                    .col-8
                        +formChangeMulti(`${prefixAdmin}/products/change-multi?_method=PATCH`)
                    if(role.permission.includes("products_create"))
                        .col-4 
                            a.btn.btn-outline-success(href=`${prefixAdmin}/products/create`) Thêm mới

                table(class="table table-hover table-sm" checkbox-multi)
                    thead
                        tr
                            th 
                                input(type="checkbox" name="checkall")
                            th STT
                            th Hình ảnh
                            th Tiêu đề
                            th Giá
                            th Vị trí
                            th Trạng thái
                            th Người tạo
                            th Người sửa
                            th Hành động
                    tbody
                        each item,index in products
                            tr
                                td 
                                    input(
                                        type="checkbox"
                                        name="id"
                                        value=item.id
                                    )
                                td #{(pagination.limitItem*(pagination.currentPage - 1) + (index+1))}
                                td
                                    img(
                                    src=item.thumbnail
                                    alt=item.title
                                    width="100px"
                                    height="auto"
                                    )
                                td #{item.title}
                                td #{item.price.toLocaleString('vi-VN')}đ

                                td  
                                    input(
                                        type="number"
                                        value=item.position
                                        style="width: 68px"
                                        min="1"
                                        name="position"
                                    )
                                if(role.permission.includes("products_edit"))
                                    td  
                                        if(item.status == "active")
                                            a(href="javascript:;" data-status=item.status data-id=item.id button-change-status class="badge badge-success") Hoạt động
                                        else 
                                            a(href="javascript:;" data-status=item.status data-id=item.id button-change-status class="badge badge-danger") Dừng hoạt động
                                else 
                                    td  
                                        if(item.status == "active")
                                            button(class="badge badge-success") Hoạt động
                                        else 
                                            button(class="badge badge-danger") Dừng hoạt động
                                td 
                                    p #{item.accountFullname}
                                    if(item.createdBy.createdAt)
                                        +formatDateTime(item.createdBy.createdAt)
                                td 
                                    - const updatedBy = item.updatedBy[item.updatedBy.length - 1]
                                    if(updatedBy)
                                        p #{updatedBy.accountFullname}
                                        p
                                            +formatDateTime(updatedBy.updatedAt)
                                td  
                                    if(role.permission.includes("products_edit"))
                                        a(href=`${prefixAdmin}/products/edit/${item.id}` class="btn btn-warning btn-sm") Sửa
                                    a(href=`${prefixAdmin}/products/detail/${item.id}` class="btn btn-secondary btn-sm") Chi tiết
                                    if(role.permission.includes("products_delete"))
                                        button(class="btn btn-danger btn-sm ml-1" button-delete data-id=item.id) Xóa
                +pagination(pagination)

        form(
            action="" 
            method="POST"
            id="form-change-status"
            data-path=`${prefixAdmin}/products/change-status`
        )
        form(
            action="" 
            method="POST"
            id="form-delete-product"
            data-path=`${prefixAdmin}/products/delete`
        )
        script(src="/admin/js/product.js")
    else 
        div bạn không có quyền xem